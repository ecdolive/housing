// api
function Api(){}Api.prototype.calculate=function(month,year,price,upfront,closing,down,term,interest,pmi,hoa,extra,hoi,flood,tax,appreciation,rent){var is_percent=function(d){return!!(-1<(d+'').indexOf('%'))},make_percent=function(d,e){return(100*(d/e)).toFixed(1).replace('.0','')+'%'},make_variants=function(d,e){var f,g,h;is_percent(e)?(g=Math.round(parse_percent(e)*c.price.number),h=e,f=g):(g=parseFloat(e),h=make_percent(e,c.price.number),f=h),d.display=e,d.number=g,d.percent=h,d.opposite=f},parse_percent=function(d){if(/%/i.test(d))return parseFloat(d)/100},c={};return c.month={display:month},c.year={display:year},c.price={display:price,number:parseFloat(price)},c.closing={display:closing},make_variants(c.closing,c.closing.display),null==upfront?null!=down&&(c.down={display:down},make_variants(c.down,c.down.display),c.upfront={display:c.down.number+c.closing.number+''},make_variants(c.upfront,c.upfront.display)):(c.upfront={display:upfront},make_variants(c.upfront,c.upfront.display),c.down={number:c.upfront.number-c.closing.number},c.down.display=make_percent(c.down.number,c.price.number),make_variants(c.down,c.down.number)),c.term={display:term,number:parseFloat(term)},c.interest={display:interest,percent:parse_percent(interest)},c.pmi={display:pmi,percent:parse_percent(pmi)},c.hoa={display:hoa,number:parseFloat(hoa)},c.extra={display:extra,number:parseFloat(extra)},null==hoi?(c.hoi={number:Math.round(3.5*(c.price.display/1e3))},c.hoi.display=c.hoi.number+''):c.hoi={display:hoi,number:parseFloat(hoi)},null==flood?(c.flood={number:Math.round(1.8*(c.price.display/1e3))},c.flood.display=c.flood.number+''):c.flood={display:flood,number:parseFloat(flood)},c.tax={display:tax,percent:parse_percent(tax)},c.appreciation={display:appreciation,percent:parse_percent(appreciation)},c.rent={display:rent,number:parseFloat(rent)},c._output={},c._output.loan=c.price.number-c.down.number,c._output.monthly_interest_rate=c.interest.percent/12,c._output.yearly_pmi=c._output.loan*c.pmi.percent,c._output.monthly_pmi=.2>c.down.number/c._output.loan?Math.round(parseFloat(c._output.yearly_pmi/12)):0,c._output.yearly_hoa=12*c.hoa.number,c._output.yearly_rent=12*c.rent.number,c._output.monthly_principle_interest=Math.round(parseFloat(function(d,e,f,g,h){var i,j;return(g||(g=0),h||(h=0),0===d)?-(f+g)/e:(j=Math.pow(1+d,e),i=-d*f*(j+g)/(j-1),1===h&&(i/=1+d),i)}(c._output.monthly_interest_rate,12*c.term.number,-c._output.loan))),c._output.monthly_tax=c.price.number*c.tax.percent/12,c._output.monthly_tax_insurance_dues=Math.round(c._output.monthly_tax+c._output.monthly_pmi+c.hoi.number/12+c.flood.number/12+c.hoa.number),c._output.monthly_mortgage_payment=Math.round(parseFloat(c._output.monthly_principle_interest)+parseFloat(c.extra.number)),c._output.total_monthly_payments=Math.round(parseFloat(c._output.monthly_mortgage_payment)+parseFloat(c._output.monthly_tax_insurance_dues)+parseFloat(c.hoa.number)),c._output.number_of_payments=Math.round(function(rate,payment,present,future,type){if(0==rate)return-(present/payment);var type='undefined'==typeof type?0:type,future='undefined'==typeof future?0:future;rate=eval(rate);var num=payment*(1+rate*type)-future*rate,den=present*rate+payment*(1+rate*type);return Math.log(num/den)/Math.log(1+rate)}(c._output.monthly_interest_rate,-c._output.monthly_mortgage_payment,c._output.loan)),c._output.years_to_pay_off=Number.isInteger(c._output.number_of_payments/12)?c._output.number_of_payments/12:(c._output.number_of_payments/12).toFixed(2),c._output.total_mortgage_payments=Number.isInteger(c._output.number_of_payments*c._output.monthly_mortgage_payment)?c._output.number_of_payments*c._output.monthly_mortgage_payment:Math.round(c._output.number_of_payments*c._output.monthly_mortgage_payment),c._output.total_interest=Number.isInteger(c._output.total_mortgage_payments-c._output.loan)?c._output.total_mortgage_payments-c._output.loan:Math.round(c._output.total_mortgage_payments-c._output.loan),c};var api=new Api;
// core
var cookies,loc={},send={},values,master;$(function(){$.fn.notFocused=function(b){return $(this).is(':focus')||$(this).val(b),this}}(jQuery));function Debug(){}Debug.prototype.log=function(b){(isLocalHost()||'beta.realisticmortgage.com'===location.hostname)&&console.log(b)},Debug.prototype.mode=function(){var b=$('.menu > ul > li > .input > input, .menu > ul > li > .input > select'),c=$('.insight > .input > input');$.each(b,function(){var f='('+$(this).attr('id')+') ';$(this).parent().siblings('.label').prepend(f)}),$.each(c,function(){var f='('+$(this).attr('id')+') ';$(this).parent().before(f)})};var debug=new Debug;api_call=function(){debug.log('\tapi_call()'),values=api.calculate(send.month,send.year,send.price,send.upfront,send.closing,send.down,send.term,send.interest,send.pmi,send.hoa,send.extra,send.hoi,send.flood,send.tax,send.appreciation,send.rent)},auto_width=function(b){var c=0,f=$('<div></div>');$('body').append(f),$(f).css({position:'absolute',left:-1e3,top:-1e3,display:'none'}),$(f).html($(b).val());$.each(['font-size','font-style','font-weight','font-family','line-height','text-transform','letter-spacing'],function(){var j=this.toString();$(f).css(j,$(b).css(j))}),c=$(f).outerWidth(),$(f).remove(),$(b).css('width',c)},auto_width_inputs=function(){debug.log('\tauto_width_inputs()'),auto_width($('#e4z')),auto_width($('#e1z')),auto_width($('#u94z')),auto_width($('#u96z'))},cookies_get=function(){debug.log('cookies_get()'),cookies=Cookies.get(),isLocalHost()&&(cookies={}),(!cookies.version||1.1>cookies.version)&&cookies_migrate(),cookies_set('version',1.1)},cookies_migrate=function(){$.each(cookies,function(b,c){(isJsonString(c)||'none'==b)&&cookies_remove(b)})},cookies_remove=function(b){Cookies.remove(b),delete cookies[b],debug.log('\tCookies.remove("'+b+'")')},cookies_remove_all=function(){$.each(cookies,function(b){isAnalyticsCookie(b)||cookies_remove(b)})},cookies_set=function(b,c){Cookies.set(b,c,{expires:3650}),cookies[b]=c,debug.log('\tCookie.set("'+b+'","'+c+'",{expires:3650})')},copyObject=function(b){return JSON.parse(JSON.stringify(b))},date_display=function(b,c){var j,f=b.getMonth(),g=b.getFullYear();return 0===f?j='Jan':1===f?j='Feb':2===f?j='Mar':3===f?j='Apr':4===f?j='May':5===f?j='Jun':6===f?j='Jul':7===f?j='Aug':8===f?j='Sep':9===f?j='Oct':10===f?j='Nov':11===f?j='Dec':void 0,'m'==c?f:'mmm'==c?j:'yyyy'==c?g:j+' '+g},date_build=function(){debug.log('date_build()');var b=new Date,c=b.getMonth(),f=b.getFullYear(),g=new Date;g.setFullYear(f-30),g=date_display(g,'yyyy');for(var j=[],l=0;12>l;l++){var p=new Date(f,l),q=date_display(p,'mmm'),r=$('<option></option>').val(l).html(q);l==c&&r.prop('selected',!0),j.push(r)}$('#month').append(j);for(var s=[],l=0;44>l;l++){var p=new Date(g+l,0),q=date_display(p,'yyyy'),r=$('<option></option>').val(q).html(q);f==q&&r.prop('selected',!0),s.push(r)}$('#year').append(s)};function debounce(b,c,f){var g;return function(){var j=this,l=arguments,q=f&&!g;clearTimeout(g),g=setTimeout(function(){g=null,f||b.apply(j,l)},c),q&&b.apply(j,l)}}display_all=function(){debug.log('\tdisplay_all()'),$('#locations > li[data-value="'+loc.id+'"]').addClass('selected'),$('#month').val(values.month.display),$('#year').val(values.year.display),$('#price').notFocused(values.price.display),$('#upfront').notFocused(values.upfront.display),$('#upfront_opposite').text(values.upfront.opposite),$('#closing').notFocused(values.closing.display),$('#closing_opposite').text(values.closing.opposite),$('#down').notFocused(values.down.display),$('#down_opposite').text(values.down.opposite),$('#term').notFocused(values.term.display),$('#interest').notFocused(values.interest.display),$('#pmi').notFocused(values.pmi.display),$('#hoa').notFocused(values.hoa.display),$('#extra').notFocused(values.extra.display),$('#hoi').notFocused(values.hoi.display),$('#flood').notFocused(values.flood.display),$('#tax').notFocused(values.tax.display),$('#appreciation').notFocused(values.appreciation.display),$('#rent').notFocused(values.rent.display),$('#u0').val(values._output.loan),$('#u11m').val(values._output.monthly_pmi),$('#u91').val(values._output.monthly_principle_interest),$('#u92').val(values._output.monthly_tax_insurance_dues),$('#u94a').val(values._output.total_monthly_payments),$('#u93').val(values._output.monthly_mortgage_payment),$('#u96a').val(values._output.years_to_pay_off),$('#u95').val(values._output.number_of_payments),$('#u97').val(values._output.total_mortgage_payments),$('#u98').val(values._output.total_interest),$('#u17').val(values._output.yearly_rent),$('#e4z').notFocused(values.upfront.number),$('#e1z').notFocused(values.price.display),$('#u94z').val(values._output.total_monthly_payments),$('#u96z').val(values._output.years_to_pay_off)},input_edit=debounce(function(b){var c=$(b).attr('id');debug.log('input_edit(#'+c+')');var f=$(b).data('cookie'),g=$(b).val();g!=values[f].display&&(g?(cookies_set(f,g),send[f]=g):(cookies_remove(f),send[f]=null),'upfront'==c||'e4z'==c?(cookies_remove('down'),master_set('upfront')):'down'==c&&(cookies_remove('upfront'),master_set('down')),api_call(),display_all(),auto_width_inputs())},100),init_values=function(){debug.log('init_values()'),loc.id=cookies.location||'atlanta',loc.data=locations[loc.id]||{},send.price=loc.data.price||cookies.price||'250000',send.upfront=loc.data.upfront||cookies.upfront||null,send.down=loc.data.down||cookies.down||'3%',send.upfront?master_set('upfront'):master_set('down'),send.closing=loc.data.closing||cookies.closing||'5%',send.tax=loc.data.tax||cookies.tax||'0.87%',send.hoi=loc.data.hoi||cookies.hoi||null,send.flood=loc.data.flood||cookies.flood||null,send.month=loc.data.month||cookies.month||$('#month').val(),send.year=loc.data.year||cookies.year||$('#year').val(),send.term=loc.data.term||cookies.term||'30',send.interest=loc.data.interest||cookies.interest||'3.875%',send.pmi=loc.data.pmi||cookies.pmi||'1.15%',send.hoa=loc.data.hoa||cookies.hoa||'0',send.extra=loc.data.extra||cookies.extra||'0',send.appreciation=loc.data.appreciation||cookies.appreciation||'2%',send.rent=loc.data.rent||cookies.rent||'1275',api_call(),display_all(),auto_width_inputs()},isAnalyticsCookie=function(b){return'_ga'==b||'_gid'==b||'_gat'==b},isNumber=function(b){return b=b.replace(',',''),parseFloat(b)},isObject=function(b){return'object'==typeof b&&null!==b},isJsonString=function(b){if('string'!=typeof b)return!1;if('{'!=b.substring(0,1)&&'['!=b.substring(0,1))return!1;try{JSON.parse(b)}catch(c){return!1}return!0},isLocalHost=function(){return'localhost'===location.hostname||'127.0.0.1'===location.hostname||''===location.hostname},isVersionCookie=function(b){return!('version'!=b)},location_select=function(b){debug.log('location_select()'),$(b).data()?(loc.id=$(b).data('value'),locations[loc.id]&&($('#locations > li').removeClass(),$(b).addClass('selected'),loc.data=locations[loc.id]||{},$.each(locations[loc.id],function(c,f){'name'!=c&&(send[c]=f,cookies_remove(c))}),cookies_set('location',loc.id),api_call(),display_all(),auto_width_inputs()),ga('send','event','location','select',loc.id),debug.log('\tga(\'send\',\'event\',\'location\',\'select\',\''+loc.id+'\')')):(ga('send','event','location','select','unknown'),debug.log('\tga(\'send\',\'event\',\'location\',\'select\',\'unknown\')'))},master_set=function(b){debug.log('\tmaster_set("'+b+'")'),'upfront'==b&&($('#upfront, #e4z').removeClass('slave'),$('#down').addClass('slave'),master='upfront',send.down=null),'down'==b&&($('#down').removeClass('slave'),$('#upfront, #e4z').addClass('slave'),master='down',send.upfront=null)},menu_close=function(b){$('body').removeClass('menu-open').addClass('menu-closed'),b?ga('send','event','menu','close',b):ga('send','event','menu','close')},menu_open=function(b){$('body').removeClass('menu-closed').addClass('menu-open'),b?ga('send','event','menu','open',b):ga('send','event','menu','open')},menu_toggle=function(){$('body').hasClass('menu-closed')?menu_open('details toggle'):menu_close('details toggle')},table_row=function(b){var c='<tr>';return $.each(b,function(f,g){c+='<td>'+g+'</td>'}),c+='</tr>',c};
// locations
var locations={custom:{name:"Custom"},atlanta:{name:"Atlanta",tax:"1.732%",rent:"1648"},chicago:{name:"Chicago",tax:"1.9066%",rent:"1878"},san_francisco:{name:"San Francisco",tax:"1.1792%",rent:"3803"},seattle:{name:"Seattle",tax:"0.9248%",rent:"2210"}};
// init
$(function(){$('#btn-open').on('click',function(){menu_open()}),$('#btn-close, #tint').on('click',function(){menu_close()}),$('#btn-details').on('click',function(){menu_toggle()}),$('input').on('keyup',function(){input_edit(this)}),$('input[type=checkbox]').on('change',function(){calculate()}),$('#locations > li').on('click',function(){location_select(this)}),$('select').on('change',function(){input_edit(this)}),date_build(),cookies_get(),init_values()});
